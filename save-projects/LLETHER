(DEFINEQ

(\CHECKSUM
  [LAMBDA (BASE NWORDS INITSUM)                              (* bvm%: "14-Feb-85 22:20")
    (PROG ((CHECKSUM (COND
                        (INITSUM (LOGAND INITSUM MASKWORD1'S))
                        (T 0)))
           (ADDR BASE)
           (CNT NWORDS))
          (while (IGREATERP CNT 0) do 
                                      (* ;; "Algorithm: Do 1's complement add of next base word, then rotate sum left one.  If result is all ones, then make it zero")

                                      (COND
                                         ([IGREATERP CHECKSUM (SETQ CHECKSUM (IPLUS16 CHECKSUM
                                                                                    (\GETBASE ADDR 0]
                                                             (* ; 
                                         "There was a carry, so add it back in -- 'end around carry'")
                                          (add CHECKSUM 1)))
                                      [SETQ CHECKSUM (COND
                                                        ((IGREATERP CHECKSUM 32767)
                                                         (LOGOR 1 (LLSH (LOGAND CHECKSUM 32767)
                                                                        1)))
                                                        (T (LLSH CHECKSUM 1] 
                                                             (* ; "ROT")
                                      (SETQ ADDR (\ADDBASE ADDR 1))
                                      (SETQ CNT (SUB1 CNT)))
          (RETURN (COND
                     ((EQ CHECKSUM MASKWORD1'S)
                      0)
                     (T CHECKSUM])
)
